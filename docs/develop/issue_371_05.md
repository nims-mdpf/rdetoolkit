# Issue #371 - Task 05: Update documentation

## Overview
Update project documentation to include the new invoice generation API and CLI functionality, providing clear usage examples and integration guidance.

## Related Information
- **Input Source**: `local/develop/issue_371.md`
- **Overview Document**: `docs/develop/issue_371_overview.md`
- **Dependencies**: Task 04 must be completed first (all implementation and tests done)

## Target Files
- [ ] `CLAUDE.md` (update with new functionality)
- [ ] Docstrings in `src/rdetoolkit/invoice_generator.py` (verify completeness)
- [ ] Docstrings in `src/rdetoolkit/cmd/gen_invoice.py` (verify completeness)
- [ ] CLI help text in `src/rdetoolkit/cli/app.py` (verify completeness)

## Implementation Steps

### Step 1: Update CLAUDE.md with new functionality
Add section to CLAUDE.md documenting the new feature:

```markdown
## Invoice Generation from Schema

### Overview
RDEToolKit provides both API and CLI methods to generate `invoice.json` files directly from `invoice.schema.json` definitions.

### API Usage

```python
from pathlib import Path
from rdetoolkit.invoice_generator import generate_invoice_from_schema

# Generate with all fields and defaults
invoice_data = generate_invoice_from_schema(
    schema_path="tasksupport/invoice.schema.json",
    output_path="invoice/invoice.json",
    fill_defaults=True,
    required_only=False,
)

# Generate required fields only, no defaults
invoice_data = generate_invoice_from_schema(
    schema_path="tasksupport/invoice.schema.json",
    output_path="invoice/invoice.json",
    fill_defaults=False,
    required_only=True,
)

# Get dict without writing to file
invoice_data = generate_invoice_from_schema(
    schema_path="tasksupport/invoice.schema.json",
    fill_defaults=True,
)
```

### CLI Usage

```bash
# Basic usage - generates invoice.json in current directory
rdetoolkit gen-invoice tasksupport/invoice.schema.json

# Specify output path
rdetoolkit gen-invoice tasksupport/invoice.schema.json -o container/data/invoice/invoice.json

# Generate required fields only
rdetoolkit gen-invoice tasksupport/invoice.schema.json --required-only

# Generate without default values
rdetoolkit gen-invoice tasksupport/invoice.schema.json --no-fill-defaults

# Generate with compact formatting
rdetoolkit gen-invoice tasksupport/invoice.schema.json --format compact

# Combined options
rdetoolkit gen-invoice tasksupport/invoice.schema.json \
  -o output/invoice.json \
  --required-only \
  --format compact

# View help
rdetoolkit gen-invoice --help
```

### Options

- `--output, -o PATH`: Output path for invoice.json (default: ./invoice.json)
- `--fill-defaults/--no-fill-defaults`: Populate type-based default values (default: True)
- `--required-only`: Include only required fields from schema (default: False)
- `--format [pretty|compact]`: Output JSON format (default: pretty)

### Default Value Strategy

When `fill_defaults=True`, the generator uses the following priority:

1. **Schema `default` field**: If the property defines a default value, use it
2. **Schema `examples` field**: If examples exist, use the first one
3. **Type-based defaults**:
   - `string` → `""`
   - `number` → `0.0`
   - `integer` → `0`
   - `boolean` → `false`
   - `array` → `[]`
   - `object` → `{}`

### Validation

Generated invoices are automatically validated against the schema using `InvoiceValidator`. If validation fails, clear error messages indicate which fields need correction.

### Integration with Workflows

```python
from pathlib import Path
from rdetoolkit.invoice_generator import generate_invoice_from_schema

def setup_invoice_template():
    """Generate invoice template for workflow."""
    generate_invoice_from_schema(
        schema_path=Path("tasksupport/invoice.schema.json"),
        output_path=Path("container/data/invoice/invoice.json"),
        fill_defaults=True,
    )

# Use in custom dataset function
def custom_dataset(srcpaths, resource_paths):
    # Generate fresh invoice if needed
    if not resource_paths.invoice.exists():
        generate_invoice_from_schema(
            schema_path=resource_paths.invoice_schema_json,
            output_path=resource_paths.invoice,
        )
    # ... rest of processing
```
```

### Step 2: Verify all docstrings are complete

**invoice_generator.py**:
- [ ] Module docstring explains purpose and usage
- [ ] `generate_invoice_from_schema()` has complete docstring with:
  - [ ] Summary
  - [ ] Args section with all parameters
  - [ ] Returns section
  - [ ] Raises section with all exceptions
  - [ ] Examples section with code examples
- [ ] All helper functions have docstrings
- [ ] All parameters have type hints

**cmd/gen_invoice.py**:
- [ ] Module docstring explains command purpose
- [ ] `GenerateInvoiceCommand` class docstring with:
  - [ ] Class summary
  - [ ] Attributes section
  - [ ] Example usage
- [ ] `__init__()` docstring with Args section
- [ ] `invoke()` docstring with:
  - [ ] Process flow description
  - [ ] Raises section
- [ ] All helper methods have docstrings

**cli/app.py (gen_invoice command)**:
- [ ] Command function has comprehensive docstring
- [ ] Docstring includes CLI usage examples
- [ ] All parameters have help text in Annotated
- [ ] Help text is clear and actionable

### Step 3: Verify CLI help output
Run and verify the help text is clear and complete:

```bash
# Check main help includes new command
rdetoolkit --help

# Check command-specific help
rdetoolkit gen-invoice --help
```

Expected help output should include:
- Clear command description
- All options with descriptions
- Usage examples
- Default values indicated

### Step 4: Update AGENTS.md if needed
If there are any agent-specific patterns for invoice generation, add them to AGENTS.md.

### Step 5: Create usage examples in docstrings
Ensure all public APIs have runnable examples in docstrings that work with pytest's doctest:

```python
def generate_invoice_from_schema(...) -> dict[str, Any]:
    """Generate invoice.json from invoice.schema.json.

    ...

    Examples:
        >>> from pathlib import Path
        >>> # Generate with defaults to file
        >>> invoice = generate_invoice_from_schema(
        ...     Path("invoice.schema.json"),
        ...     Path("invoice.json"),
        ...     fill_defaults=True
        ... )
        >>> assert "datasetId" in invoice
        >>> assert "basic" in invoice

        >>> # Generate required only, no file output
        >>> invoice = generate_invoice_from_schema(
        ...     Path("invoice.schema.json"),
        ...     required_only=True
        ... )
        >>> assert isinstance(invoice, dict)
    """
```

## Completion Criteria
- [ ] CLAUDE.md updated with new Invoice Generation section
- [ ] Section includes both API and CLI usage examples
- [ ] All docstrings follow Google Style guide
- [ ] All public APIs have complete docstrings with examples
- [ ] CLI help text is clear and comprehensive
- [ ] `rdetoolkit --help` shows gen-invoice command
- [ ] `rdetoolkit gen-invoice --help` displays complete usage info
- [ ] Documentation examples are tested and work correctly
- [ ] No typos or grammatical errors
- [ ] Documentation is consistent with existing style

## Notes
- Follow existing CLAUDE.md structure and style
- Use actual working examples that users can copy-paste
- Include common use cases and edge cases
- Reference related features (validation, schema generation)
- Keep documentation concise but comprehensive
- Use proper markdown formatting
- Add links to relevant sections where helpful

## Documentation Review Checklist

### API Documentation
- [ ] Function signature is clear
- [ ] All parameters are explained
- [ ] Return value is explained
- [ ] Exceptions are documented
- [ ] Examples are provided and tested
- [ ] Type hints are complete

### CLI Documentation
- [ ] Command syntax is clear
- [ ] All options are explained
- [ ] Default values are indicated
- [ ] Examples cover common use cases
- [ ] Error scenarios are mentioned

### Integration Documentation
- [ ] Shows how to use in workflows
- [ ] Integration with existing features explained
- [ ] Best practices mentioned
- [ ] Common patterns documented

## Example Documentation Snippets

### For quick reference section:
```markdown
## Quick Reference: Invoice Generation

| Task | Command |
|------|---------|
| Generate default invoice | `rdetoolkit gen-invoice schema.json` |
| Custom output path | `rdetoolkit gen-invoice schema.json -o path/invoice.json` |
| Required fields only | `rdetoolkit gen-invoice schema.json --required-only` |
| Compact format | `rdetoolkit gen-invoice schema.json --format compact` |
```

### For API reference:
```markdown
## API Reference

### generate_invoice_from_schema()

**Module**: `rdetoolkit.invoice_generator`

**Signature**:
```python
generate_invoice_from_schema(
    schema_path: Path | str,
    output_path: Path | str | None = None,
    *,
    fill_defaults: bool = True,
    required_only: bool = False,
) -> dict[str, Any]
```

**Parameters**:
- `schema_path`: Path to invoice.schema.json
- `output_path`: Optional output path for invoice.json
- `fill_defaults`: Populate default values (default: True)
- `required_only`: Include only required fields (default: False)

**Returns**: Generated invoice data as dictionary

**Raises**:
- `FileNotFoundError`: Schema file not found
- `ValueError`: Invalid schema structure
- `InvoiceSchemaValidationError`: Generated invoice invalid
```
