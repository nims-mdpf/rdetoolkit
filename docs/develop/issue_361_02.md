# Issue #361 - Task 02: Improve File Not Found Error Handling

## Overview
Add explicit file not found error handling with clear file paths and helpful guidance. Replace silent failures with informative ConfigError exceptions when configuration files don't exist.

## Related Information
- **Input Source**: `/Users/sonokawa/github/rdetoolkit-worktrees/develop-v152_361/local/develop/issue_361.md`
- **Overview Document**: `docs/develop/issue_361_overview.md`
- **Dependencies**: Task 01 (ConfigError class)

## Target Files
- [ ] `src/rdetoolkit/config.py` (modify parse_config_file and get_config)
- [ ] `tests/test_config.py` (add file not found tests)

## Implementation Steps

### Step 1: Add file existence check in parse_config_file
Modify `parse_config_file()` to check file existence and raise ConfigError with helpful message.

**Location**: `src/rdetoolkit/config.py`, function `parse_config_file()`

```python
from rdetoolkit.exceptions import ConfigError

def parse_config_file(*, path: str | None = None) -> Config:
    """Parse the configuration file and return a Config object.

    Args:
        path (str, optional): The path to the configuration file.

    Returns:
        Config: The parsed configuration object.

    Raises:
        ConfigError: If the configuration file is not found or cannot be parsed.

    # ... rest of docstring ...
    """
    # Add file existence check when path is provided
    if path is not None:
        path_obj = Path(path)
        if not path_obj.exists():
            raise ConfigError(
                f"Configuration file not found: '{path}'. "
                f"Create a configuration file or use 'rdetoolkit gen-config' to generate one.",
                file_path=path,
                error_type="file_not_found",
            )

    # ... rest of the function implementation ...
```

### Step 2: Update __read_pyproject_toml to handle missing files
Modify `__read_pyproject_toml()` to check file existence before attempting to read.

**Location**: `src/rdetoolkit/config.py`, function `__read_pyproject_toml()`

```python
def __read_pyproject_toml(path: str) -> dict[str, Any]:
    """Read the pyproject.toml file and return the contents as a dictionary.

    Args:
        path: Path to the pyproject.toml file

    Returns:
        dict[str, Any]: The contents of the pyproject.toml file.

    Raises:
        ConfigError: If the file does not exist
    """
    path_obj = Path(path)
    if not path_obj.exists():
        raise ConfigError(
            f"Configuration file not found: '{path}'. "
            f"Create a pyproject.toml file with [tool.rdetoolkit] section.",
            file_path=path,
            error_type="file_not_found",
        )

    toml = TOMLFile(path)
    obj = toml.read()
    _obj = obj.unwrap()
    return _obj.get("tool", {}).get("rdetoolkit", {})
```

### Step 3: Update get_config to handle directory not found
Modify `get_config()` to provide clear error when target directory doesn't exist.

**Location**: `src/rdetoolkit/config.py`, function `get_config()`

```python
def get_config(target_dir_path: RdeFsPath) -> Config | None:
    """Retrieves the configuration from the specified directory path.

    # ... docstring ...
    """
    if isinstance(target_dir_path, str):
        target_dir_path = Path(target_dir_path)

    if not target_dir_path.exists():
        # Raise error instead of returning None for better error visibility
        raise ConfigError(
            f"Configuration directory not found: '{target_dir_path}'. "
            f"Ensure the directory exists and contains a valid configuration file.",
            file_path=str(target_dir_path),
            error_type="directory_not_found",
        )

    # ... rest of the function ...
```

### Step 4: Add unit tests for file not found scenarios

**Location**: `tests/test_config.py`

Add tests following the project's testing standards (Given/When/Then pattern):

```python
def test_parse_config_file_not_found():
    """Test ConfigError is raised when config file doesn't exist.

    Test ID: TC-EP-FILE-001
    """
    # Given: non-existent config file path
    nonexistent_path = "nonexistent_config.yaml"

    # When: attempting to parse the file
    # Then: ConfigError is raised with file path and helpful message
    with pytest.raises(ConfigError) as exc_info:
        parse_config_file(path=nonexistent_path)

    error = exc_info.value
    assert error.file_path == nonexistent_path
    assert error.error_type == "file_not_found"
    assert "not found" in str(error).lower()
    assert "gen-config" in str(error)
    assert "https://nims-mdpf.github.io/rdetoolkit/" in str(error)


def test_get_config_directory_not_found():
    """Test ConfigError is raised when target directory doesn't exist.

    Test ID: TC-EP-DIR-001
    """
    # Given: non-existent directory path
    nonexistent_dir = Path("nonexistent_directory_12345")

    # When: attempting to get config from the directory
    # Then: ConfigError is raised with directory path
    with pytest.raises(ConfigError) as exc_info:
        get_config(nonexistent_dir)

    error = exc_info.value
    assert str(nonexistent_dir) in error.file_path
    assert error.error_type == "directory_not_found"
    assert "not found" in str(error).lower()


def test_read_pyproject_toml_not_found():
    """Test ConfigError is raised when pyproject.toml doesn't exist.

    Test ID: TC-EP-TOML-001
    """
    # Given: non-existent pyproject.toml path
    nonexistent_toml = "nonexistent_pyproject.toml"

    # When: attempting to read the file
    # Then: ConfigError is raised
    from rdetoolkit.config import __read_pyproject_toml

    with pytest.raises(ConfigError) as exc_info:
        __read_pyproject_toml(nonexistent_toml)

    error = exc_info.value
    assert error.file_path == nonexistent_toml
    assert error.error_type == "file_not_found"
```

## Completion Criteria
- [ ] File existence checks added to parse_config_file
- [ ] __read_pyproject_toml checks file existence before reading
- [ ] get_config raises ConfigError for non-existent directories
- [ ] All error messages include file paths
- [ ] All error messages include documentation links
- [ ] Error messages provide actionable guidance (e.g., "use gen-config")
- [ ] Tests added for all file not found scenarios (3+ test cases)
- [ ] Tests verify error type, file path, and message content
- [ ] Tests pass (`tox -e py312-module -- tests/test_config.py`)
- [ ] No new type errors (`tox -e mypy`)
- [ ] Code follows project style (`tox -e ruff`)

## Notes
- Current implementation silently returns default Config or None on missing files
- This change makes errors explicit and visible to users
- Error messages guide users toward resolution (create file, use gen-config)
- Backward compatibility: code expecting None from get_config will need updates
